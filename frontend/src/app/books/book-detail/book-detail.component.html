<div class="book-detail-container">
  <app-navbar></app-navbar>

  <div class="content-container">
    <div *ngIf="loading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Chargement du livre...</p>
    </div>

    <div *ngIf="error" class="error-container">
      <mat-icon class="error-icon">error</mat-icon>
      <h2>Livre non trouvé</h2>
      <p>Le livre que vous recherchez n'existe pas ou a été supprimé.</p>
      <button mat-raised-button color="primary" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Retour
      </button>
    </div>

    <div *ngIf="!loading && !error && book" class="book-detail">
      <div class="back-nav">
        <button mat-button (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
          Retour
        </button>
      </div>

      <div class="book-layout">
        <div class="book-cover-container">
          <img
            *ngIf="book.coverImageUrl"
            [src]="getBookCoverUrl(book.coverImageUrl)"
            [alt]="book.title"
            class="book-cover"
            (error)="handleImageError($event)"
          />
          <div *ngIf="!book.coverImageUrl" class="placeholder-cover">
            <mat-icon>menu_book</mat-icon>
          </div>

          <div class="book-actions">
            <button mat-raised-button color="primary" (click)="borrowBook()">
              <mat-icon>book</mat-icon>
              Emprunter
            </button>

            <button
              mat-icon-button
              color="warn"
              [class.favorite]="isFavorite"
              (click)="toggleFavorite()"
            >
              <mat-icon>{{
                isFavorite ? "favorite" : "favorite_border"
              }}</mat-icon>
            </button>
          </div>
        </div>

        <div class="book-info">
          <h1 class="book-title">{{ book.title }}</h1>
          <h2 class="book-author">par {{ book.author }}</h2>

          <div class="book-metadata">
            <div *ngIf="book.publishedYear" class="metadata-item">
              <mat-icon>calendar_today</mat-icon>
              <span>{{ book.publishedYear }}</span>
            </div>

            <div *ngIf="book.publisher" class="metadata-item">
              <mat-icon>business</mat-icon>
              <span>{{ book.publisher }}</span>
            </div>

            <div *ngIf="book.pageCount" class="metadata-item">
              <mat-icon>menu_book</mat-icon>
              <span>{{ book.pageCount }} pages</span>
            </div>

            <div *ngIf="book.language" class="metadata-item">
              <mat-icon>language</mat-icon>
              <span>{{ book.language }}</span>
            </div>
          </div>

          <div *ngIf="book.genre" class="genre-tag">
            <span>{{ book.genre }}</span>
          </div>

          <h3 class="section-title">Description</h3>
          <p class="book-description">{{ book.description }}</p>

          <div *ngIf="book.isbn" class="book-isbn">
            <strong>ISBN:</strong> {{ book.isbn }}
          </div>
        </div>
      </div>

      <!-- Affichage des exemplaires (pour tous les utilisateurs) -->
      <div class="book-copies-section">
        <app-book-copies
          [bookId]="book.id"
          [bookTitle]="book.title"
          [bookCopies]="book.copies"
        ></app-book-copies>

        <!-- Bouton de débogage pour les exemplaires -->
        <button
          *ngIf="book.copies && book.copies.length > 0"
          mat-button
          color="accent"
          (click)="debugCopies()"
        >
          Déboguer les exemplaires ({{ book.copies.length }})
        </button>
      </div>
    </div>
  </div>
</div>
